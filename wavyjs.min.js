function wavyjs(){"use strict";this.me=wavyjs.count++,this.filename="",this.rptr=0,this.wptr=0,this.fmt=0,this.data=0,this.rate=0,this.channels=0,this.bits=0,this.bytes=0,this.inc=0,this.type=0,this.samples=0,this.raw=null,this.sound=null,this.max=[],this.max_idx=[],this.avg=[]}wavyjs.count=0,DataView.prototype.getInt24=function(t){"use strict";return(this.getInt16(t)<<8)+this.getInt8(t+2)},DataView.prototype.setInt24=function(t,s){"use strict";this.setInt16(t,s>>8),this.setInt8(t+2,255&s)},wavyjs.prototype.make=function(t,s,i,e,n=1){this.channels=t,this.rate=s,this.bits=i,this.inc=i/8,this.type=n,this.bytes=this.inc*t,this.samples=Math.round(e);var h,r,a=44+this.samples*t*i/8,o=s*i/8*t;for(this.raw=new ArrayBuffer(a),this.sound=new DataView(this.raw),this.fmt=12,this.data=36,this.rptr=44,this.wptr=44,this.sound.setInt32(0,1380533830,!1),this.sound.setInt32(4,a-8,!0),this.sound.setInt32(8,1463899717,!1),this.sound.setInt32(12,1718449184,!1),this.sound.setInt16(16,16,!0),this.sound.setInt16(20,this.type,!0),this.sound.setInt16(22,t,!0),this.sound.setInt32(24,s,!0),this.sound.setInt32(28,o,!0),this.sound.setInt16(32,this.bytes,!0),this.sound.setInt16(34,i,!0),this.sound.setInt32(36,1684108385,!1),this.sound.setInt32(40,a-44,!0),h=0;h<this.samples;h++)for(r=0;r<t;r++)this.set_sample(h,r,0);this.rptr=44,this.wptr=44},wavyjs.prototype.set_sample=function(t,s,i){"use strict";var e=Math.round(t),n=s>this.channels-1?0:s,h=this.channels*this.bits/8*e+this.data+8+n*this.bits/8,r=3==this.type?i:Math.round(i);this.wptr=h,null!=this.raw&&(e>this.samples||h>=this.raw.byteLength||null==h||(8==this.bits?this.sound.setUint8(h,r+128):16==this.bits?this.sound.setInt16(h,r,!0):24==this.bits?this.sound.setInt24(h,r,!0):32==this.bits&&1==this.type?this.sound.setInt32(h,r,!0):32==this.bits&&3==this.type&&this.sound.setFloat32(h,r,!0)))},wavyjs.prototype.push_sample=function(t){"use strict";null!=this.raw&&(this.wptr>=this.raw.byteLength||null==this.wptr||(8==this.bits?this.sound.setUint8(this.wptr,t+128):16==this.bits?this.sound.setInt16(this.wptr,t,!0):24==this.bits?this.sound.setInt24(this.wptr,t,!0):32==this.bits&&1==this.type?this.sound.setInt32(this.wptr,t,!0):32==this.bits&&3==this.type&&this.sound.setFloat32(this.wptr,t,!0),this.wptr+=this.inc))},wavyjs.prototype.get_sample=function(t,s){"use strict";var i,e=Math.round(t),n=s>this.channels-1?0:s,h=this.channels*this.bits/8*e+this.data+8+n*this.bits/8;return this.rptr=h,null==this.raw?NaN:e>this.samples||h>this.raw.byteLength-this.bits/8?0:(8==this.bits?i=this.sound.getUint8(h)-128:16==this.bits?i=this.sound.getInt16(h,!0):24==this.bits?i=this.sound.getInt24(h,!0):32==this.bits&&1==this.type?i=this.sound.getInt32(h,!0):32==this.bits&&3==this.type&&(i=this.sound.getFloat32(h,!0)),i)},wavyjs.prototype.pop_sample=function(){"use strict";return null==this.raw?NaN:this.rptr>=this.raw.byteLength||null==this.rptr?NaN:(8==this.bits?t=this.sound.getUint8(this.rptr)-128:16==this.bits?t=this.sound.getInt16(this.rptr,!0):24==this.bits?t=this.sound.getInt24(this.rptr,!0):32==this.bits&&1==this.type?t=this.sound.getInt32(this.rptr,!0):32==this.bits&&3==this.type&&(t=this.sound.getFloat32(this.rptr,!0)),this.rptr+=this.inc,t);var t},wavyjs.prototype.audio=function(){"use strict";var t,s=null==this.raw?0:this.raw.byteLength,i=new ArrayBuffer(s),e=new Uint8Array(i),n=new Uint8Array(this.raw);for(t=0;t<i.byteLength;t++)e[t]=n[t];return i},wavyjs.prototype.save=function(t,s){"use strict";var i=document.createElement("a");document.body.appendChild(i),i.style="display: none";var e=new Blob([t],{type:"octet/stream"}),n=window.URL.createObjectURL(e);i.href=n,i.download=s,i.click()},wavyjs.prototype.bfr_to_b64=function(t){"use strict";var s,i="",e=new Uint8Array(t),n=e.byteLength;for(s=0;s<n;s++)i+=String.fromCharCode(e[s]);return window.btoa(i)},wavyjs.prototype.b64_to_bfr=function(t){"use strict";var s,i=window.atob(t),e=i.length,n=new Uint8Array(e);for(s=0;s<e;s++)n[s]=i.charCodeAt(s);return n.buffer},wavyjs.prototype.to_json=function(){"use strict";return this,this.raw=this.bfr_to_b64(this.raw),JSON.stringify(this)},wavyjs.prototype.from_json=function(t){"use strict";var s,i=new wavyjs;for(s in t)t.hasOwnProperty(s)&&(i[s]=t[s]);return i.raw=i.b64_to_bfr(t.raw),i.parse_header(),i},wavyjs.prototype.load_url=function(t,s,i){"use strict";var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=function(){void 0!==e.response.byteLength&&context.decodeAudioData(e.response).then(function(t){s(t)},function(t){i(t)})},e.send()},wavyjs.prototype.load_file=function(t,s,i){"use strict";if(window.File&&window.FileReader&&window.FileList&&window.Blob)for(var e=t.files,n=0;n<e.length;n++){e[n].size;var h=new FileReader,r=this,a=e[n].name;h.onload=(e[n],function(t){r.raw=t.target.result,r.sound=new DataView(r.raw),r.fmt=12,r.data=36,r.filename=a;for(var i=0;i<1024;i++){var e=r.sound.getInt32(i,!1);1718449184==e&&(r.fmt=i),1684108385==e&&(r.data=i)}r.parse_header(),s()}),h.readAsArrayBuffer(e[n])}else i("File reader not supported by your browser.")},wavyjs.prototype.parse_header=function(){"use strict";if(null==this.raw)return 0;this.sound=new DataView(this.raw),this.type=this.sound.getInt16(this.fmt+8,!0),this.bytes=this.sound.getInt16(this.fmt+20,!0),this.channels=this.sound.getInt16(this.fmt+10,!0),this.rate=this.sound.getInt32(this.fmt+12,!0),this.bits=this.sound.getInt16(this.fmt+22,!0),this.inc=this.bits/8;var t=this.sound.getInt32(this.data+4,!0);this.samples=t/this.channels/(this.bits/8),this.rptr=this.data+8,this.wptr=this.data+8,3==this.type&&console.log("NOTE: WAV file data is floating point.")},wavyjs.prototype.get_stats=function(){"use strict";var t,s,i;for(t=0;t<this.channels;t++)this.max[t]=0,this.max_idx[t]=0,this.avg[t]=0;for(s=0;s<this.samples;s++)for(t=0;t<this.channels;t++)i=this.get_sample(s,t),this.avg[t]+=i,Math.abs(i)>this.max[t]&&(this.max[t]=Math.abs(i),this.max_idx[t]=s);for(s=0,t=0;t<this.channels;t++)s+=this.max_idx[t];this.max_idx=s/this.channels},wavyjs.prototype.resample=function(t,s){"use strict";var i,e,n,h,r,a,o,u,p;if(t==this.rate&&s==this.bits)return this;for(a=1/this.rate,o=1/t,u=Math.round(this.samples*t/this.rate),(p=new wavyjs).make(this.channels,t,s,u),e=0;e<this.channels;e++)for(r=0;r<u;r++)h=Math.trunc(r*o/a),i=(n=this.get_sample(h,e))+(this.get_sample(h+1,e)-n)*(r*o-h*a)/a,3==this.type&&(i=this.float_to_int(i,s)),p.set_sample(r,e,i);return p},wavyjs.prototype.float_to_int=function(t,s){"use strict";return t*Math.pow(2,s-1)},wavyjs.prototype.int_to_float=function(t,s){"use strict";return t/Math.pow(2,s-1)},wavyjs.prototype.mix=function(t,s,i,e=1){var n,h,r,a,o=Math.round(i),u=Math.round(s);for(n=0;n<this.channels;n++)for(r=0;r<t.samples;r++)(h=u+(r-o))>=0&&h<this.samples&&(a=this.get_sample(h,n),a+=t.get_sample(r,n)*e,this.set_sample(h,n,a))};
